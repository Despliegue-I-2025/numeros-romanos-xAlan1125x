<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Conversor Romano ↔ Arábigo</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <header class="site-header">
    <div class="container">
      <h1>Conversor <span class="accent">Romano ↔ Arábigo</span></h1>
      <p class="subtitle">Proyecto Final — Varela Alan Christian Emmanuel</p>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <h2>Conversor interactivo</h2>
      <p class="muted">Escribe un número romano o arábigo y presiona convertir. Los errores vienen formateados según <code>application/problem+json</code> cuando corresponda.</p>

      <div class="form-row">
        <div class="form-block">
          <label for="romanInput"><strong>Romano → Arábigo</strong></label>
          <input id="romanInput" placeholder="Ej: XXIV" />
          <div class="actions">
            <button id="btnR2A" class="btn">Convertir a arábigo</button>
            <button id="btnClearR" class="btn ghost">Limpiar</button>
          </div>
        </div>

        <div class="form-block">
          <label for="arabicInput"><strong>Arábigo → Romano</strong></label>
          <input id="arabicInput" placeholder="Ej: 1987" inputmode="numeric" />
          <div class="actions">
            <button id="btnA2R" class="btn">Convertir a romano</button>
            <button id="btnClearA" class="btn ghost">Limpiar</button>
          </div>
        </div>
      </div>

      <div id="responseArea" class="response-area" aria-live="polite"></div>
    </section>

    <section class="card">
      <h3>Historial y detalles</h3>
      <div id="log" class="log muted">No hay acciones todavía.</div>
    </section>

    <footer class="card foot">
      <div>
        <small>API serverless desplegada en Vercel — endpoints: <code>/a2r</code> y <code>/r2a</code></small>
      </div>
      <div>
        <small><a href="/mnt/data/Unidad 8 – Armando APIs robustas.docx.pdf" target="_blank" rel="noopener">Unidad 8 – Armando APIs robustas (pdf)</a></small>
      </div>
    </footer>
  </main>

<script>
(() => {
  const romanInput = document.getElementById('romanInput');
  const arabicInput = document.getElementById('arabicInput');
  const btnR2A = document.getElementById('btnR2A');
  const btnA2R = document.getElementById('btnA2R');
  const btnClearR = document.getElementById('btnClearR');
  const btnClearA = document.getElementById('btnClearA');
  const responseArea = document.getElementById('responseArea');
  const log = document.getElementById('log');

  function appendLog(entry) {
    const time = new Date().toLocaleTimeString();
    log.innerHTML = `<div style="margin-bottom:.6rem"><strong>[${time}]</strong> ${entry}</div>` + log.innerHTML;
  }

  function showResult(success, payload) {
    // payload: object with either result or problem
    responseArea.innerHTML = '';
    const card = document.createElement('div');
    card.className = 'card';
    if (success) {
      card.innerHTML = '<h4 style="color:var(--accent)">Resultado</h4><pre>' + JSON.stringify(payload, null, 2) + '</pre>';
    } else {
      card.innerHTML = '<h4 style="color:#ff8b8b">Error</h4><pre>' + JSON.stringify(payload, null, 2) + '</pre>';
    }
    responseArea.appendChild(card);
  }

  async function callApi(path) {
    try {
      const resp = await fetch(path, {
        method: 'GET',
        headers: { 'Accept': 'application/problem+json, application/json' },
        mode: 'cors'
      });
      const ct = resp.headers.get('content-type') || '';
      const body = await resp.json().catch(() => null);
      if (!resp.ok) {
        // problem json preferred
        showResult(false, body || { status: resp.status, text: resp.statusText });
        appendLog(`REQUEST ${path} → ${resp.status} ${resp.statusText}`);
        return { ok: false, status: resp.status, body };
      } else {
        showResult(true, body);
        appendLog(`REQUEST ${path} → ${resp.status} OK`);
        return { ok: true, status: resp.status, body };
      }
    } catch (err) {
      showResult(false, { error: String(err) });
      appendLog(`REQUEST ${path} → NETWORK ERROR`);
      return { ok: false, body: { error: String(err) } };
    }
  }

  btnR2A.addEventListener('click', () => {
    const v = String(romanInput.value || '').trim();
    if (!v) { showResult(false, { detail: 'Campo romano vacío' }); return; }
    const path = `/r2a?roman=${encodeURIComponent(v)}`;
    showResult(true, { info: 'Consultando...', request: path });
    callApi(path);
  });

  btnA2R.addEventListener('click', () => {
    const v = String(arabicInput.value || '').trim();
    if (!v) { showResult(false, { detail: 'Campo arábigo vacío' }); return; }
    const path = `/a2r?arabic=${encodeURIComponent(v)}`;
    showResult(true, { info: 'Consultando...', request: path });
    callApi(path);
  });

  btnClearR.addEventListener('click', () => { romanInput.value = ''; responseArea.innerHTML=''; });
  btnClearA.addEventListener('click', () => { arabicInput.value = ''; responseArea.innerHTML=''; });

  // quick test buttons on load (do not auto-run)
  appendLog('Interfaz lista. Escribe y presiona convertir.');
})();
</script>
</body>
</html>
